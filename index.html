<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LOL è§£ç¦ / ç”³è¿°æ—¶é—´ç®¡ç†</title>
  <link rel="icon" href="https://static.wikia.nocookie.net/leagueoflegends/images/6/6c/League_of_Legends_Icon.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #010a13; color: #f0e6d2; font-family: "Microsoft YaHei", sans-serif; }
    body::before {
      content: ""; position: fixed; inset: 0;
      background: url("https://p6.qhimg.com/t01666e8536ec7a38f3.jpg") center / cover no-repeat fixed;
      filter: brightness(0.3); z-index: -2;
    }
    .hextech-card { background: rgba(30, 35, 40, 0.9); border: 1px solid #463714; box-shadow: inset 0 0 20px rgba(0,0,0,0.5); }
    .btn-lol { background: linear-gradient(to bottom, #1e2328, #111111); border: 1px solid #c8aa6e; color: #c8aa6e; transition: all 0.2s; cursor: pointer; }
    .btn-lol:hover { background: #c89b3c; color: #010a13; }
    input, select { background: rgba(10, 20, 30, 0.9) !important; border: 1px solid #463714 !important; color: #f0e6d2 !important; }
    @keyframes goldPulse { 0%, 100% { border-color: #c8aa6e; box-shadow: 0 0 5px #c8aa6e; } 50% { border-color: #f0e6d2; box-shadow: 0 0 15px #c8aa6e; } }
    .status-active { animation: goldPulse 2s infinite; }
  </style>
</head>
<body class="min-h-screen">

  <div class="max-w-5xl mx-auto p-6">
    <header class="text-center mb-10">
      <h1 class="text-3xl font-bold mb-2 tracking-[0.2em] text-[#c8aa6e]">å¬å”¤å¸ˆäº‘ç«¯åŒæ­¥ç³»ç»Ÿ</h1>
      <div class="h-[2px] w-32 bg-gradient-to-r from-transparent via-[#c8aa6e] to-transparent mx-auto mb-2"></div>
      <p id="syncStatus" class="text-[#a09b8c] text-sm italic">æ­£åœ¨æ£€æŸ¥äº‘ç«¯çŠ¶æ€...</p>
    </header>

    <div class="hextech-card p-6 rounded-sm mb-8 border-b-2 border-b-[#c8aa6e]">
      <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
        <div class="flex flex-col">
          <label class="text-xs text-[#c8aa6e] mb-1">å¬å”¤å¸ˆè´¦å·</label>
          <input id="account" placeholder="è¾“å…¥åç§°" class="p-2 rounded-sm" />
        </div>
        <div class="flex flex-col">
          <label class="text-xs text-[#c8aa6e] mb-1">è®°å½•ç±»å‹</label>
          <select id="type" class="p-2 rounded-sm">
            <option value="è§£ç¦">è´¦å·è§£ç¦</option>
            <option value="ç”³è¿°">å‘èµ·ç”³è¿°</option>
          </select>
        </div>
        <div class="flex flex-col">
          <label class="text-xs text-[#c8aa6e] mb-1">æ—¥æœŸ</label>
          <input id="date" type="date" class="p-2 rounded-sm" />
        </div>
        <div class="flex flex-col">
          <label class="text-xs text-[#c8aa6e] mb-1">å…·ä½“æ—¶é—´</label>
          <input id="time" type="text" placeholder="16:30" maxlength="5" oninput="this.value = this.value.replace(/[^\d]/g, '').replace(/(\d{2})(?=\d)/, '$1:')" class="p-2 rounded-sm font-mono text-center" />
        </div>
        <div class="flex items-end">
          <button onclick="addRecord()" class="btn-lol w-full py-2 font-bold text-sm">ä¿å­˜å¹¶åŒæ­¥</button>
        </div>
      </div>

      <div class="flex gap-6 mt-6 pt-4 border-t border-[#463714] text-[11px]">
        <button onclick="syncFromCloud()" class="text-[#c8aa6e] hover:text-white transition-colors">â˜ï¸ æ‰‹åŠ¨ä»äº‘ç«¯ä¸‹è½½</button>
        <button onclick="syncToCloud()" class="text-[#c8aa6e] hover:text-white transition-colors">â˜ï¸ æ‰‹åŠ¨å¼ºåˆ¶è¦†ç›–äº‘ç«¯</button>
        <span class="text-gray-600 ml-auto">è´¦æˆ·: yangmemory | ä»“åº“: lol-timer</span>
      </div>
    </div>

    <div class="relative mb-6">
      <input id="search" placeholder="ğŸ” æœç´¢å¬å”¤å¸ˆ..." oninput="render()" class="w-full p-3 rounded-sm italic text-sm" />
    </div>

    <div id="list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
  </div>

<script>
// --- é…ç½®ä¿¡æ¯ ---
const GITHUB_CONFIG = {
    token: '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',
    repo: 'yangmemory/lol-timer',
    path: 'data.json'
};

let records = JSON.parse(localStorage.getItem('lolRecords') || '[]');
let editIndex = null;

// åˆå§‹åŒ–ï¼šé¡µé¢æ‰“å¼€æ—¶è‡ªåŠ¨ä»äº‘ç«¯æ‹‰å–ä¸€æ¬¡
window.onload = () => {
    syncFromCloud();
};

function format24h(isoStr) {
    const d = new Date(isoStr);
    return `${d.getFullYear()}å¹´${d.getMonth() + 1}æœˆ${d.getDate()}æ—¥ ${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}`;
}

// ä»äº‘ç«¯ä¸‹è½½æ•°æ®
async function syncFromCloud() {
    document.getElementById('syncStatus').innerText = "æ­£åœ¨ä»äº‘ç«¯æ‹‰å–æ•°æ®...";
    try {
        const res = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.path}?nocache=${new Date().getTime()}`, {
            headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` }
        });
        if (res.ok) {
            const data = await res.json();
            const content = decodeURIComponent(escape(atob(data.content)));
            records = JSON.parse(content);
            localStorage.setItem('lolRecords', JSON.stringify(records));
            render();
            document.getElementById('syncStatus').innerText = "äº‘ç«¯åŒæ­¥æˆåŠŸ";
        }
    } catch (err) {
        document.getElementById('syncStatus').innerText = "äº‘ç«¯æ‹‰å–å¤±è´¥";
        console.error(err);
    }
}

// åŒæ­¥åˆ°äº‘ç«¯
async function syncToCloud() {
    document.getElementById('syncStatus').innerText = "æ­£åœ¨åŒæ­¥åˆ°äº‘ç«¯...";
    try {
        // è·å–æ–‡ä»¶ SHA
        const getRes = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.path}`, {
            headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` }
        });
        const getData = await getRes.json();
        const sha = getData.sha;

        // ä¸Šä¼ æ–°å†…å®¹
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(records))));
        const putRes = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.path}`, {
            method: 'PUT',
            headers: {
                'Authorization': `token ${GITHUB_CONFIG.token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                message: "update records",
                content: content,
                sha: sha
            })
        });

        if (putRes.ok) {
            document.getElementById('syncStatus').innerText = "æ‰€æœ‰æ›´æ”¹å·²ä¿å­˜è‡³äº‘ç«¯";
        }
    } catch (err) {
        document.getElementById('syncStatus').innerText = "åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ";
    }
}

function addRecord(){
  const account = document.getElementById('account').value.trim();
  const type = document.getElementById('type').value;
  const date = document.getElementById('date').value;
  let time = document.getElementById('time').value;

  if(!account || !date || !time) return alert('å¬å”¤å¸ˆï¼Œè¯·å®Œå–„å¤„ç½šä¿¡æ¯');
  
  const data = { account, type, datetime: `${date}T${time}` };

  if(editIndex !== null){
    records[editIndex] = data;
    editIndex = null;
  }else{
    records.push(data);
  }
  
  localStorage.setItem('lolRecords', JSON.stringify(records));
  render();
  syncToCloud(); // æ·»åŠ /ä¿®æ”¹åè‡ªåŠ¨åŒæ­¥
  
  document.getElementById('account').value = '';
  document.getElementById('date').value = '';
  document.getElementById('time').value = '';
}

function del(i){
  if(confirm('ç¡®å®šè¦ç§»é™¤æ­¤é¡¹å¤„ç½šè®°å½•å—ï¼Ÿ')) {
    records.splice(i,1);
    localStorage.setItem('lolRecords', JSON.stringify(records));
    render();
    syncToCloud(); // åˆ é™¤åè‡ªåŠ¨åŒæ­¥
  }
}

function edit(i){
  const r = records[i];
  const dt = r.datetime.split('T');
  document.getElementById('account').value = r.account;
  document.getElementById('type').value = r.type;
  document.getElementById('date').value = dt[0];
  document.getElementById('time').value = dt[1];
  editIndex = i;
  window.scrollTo({top: 0, behavior: 'smooth'});
}

function render(){
  const q = document.getElementById('search').value.toLowerCase();
  const now = Date.now();
  const box = document.getElementById('list');
  box.innerHTML='';

  records.filter(r=>r.account.toLowerCase().includes(q))
    .sort((a,b)=>new Date(a.datetime)-new Date(b.datetime))
    .forEach((r,i)=>{
      const targetTime = new Date(r.datetime).getTime();
      const diff = targetTime - now;
      const displayDateTime = format24h(r.datetime);
      const days = Math.floor(diff/86400000);
      const h = Math.floor(diff%86400000/3600000);
      const m = Math.floor(diff%3600000/60000);
      const s = Math.floor(diff%60000/1000);
      const isWarning = diff < 3 * 86400000 && diff > 0;
      const isExpired = diff <= 0;

      box.innerHTML += `
      <div class="p-5 hextech-card relative overflow-hidden ${isWarning ? 'status-active' : ''}">
        <div class="flex justify-between items-start relative z-10">
          <div>
            <div class="flex items-center gap-2 mb-1">
              <span class="px-2 py-0.5 bg-[#c8aa6e] text-black text-[10px] font-bold rounded-sm">${r.type}</span>
              <span class="text-[#f0e6d2] font-bold text-lg">${r.account}</span>
            </div>
            <div class="text-[11px] text-[#a09b8c] mb-3 font-mono">ç›®æ ‡æ—¶é—´ï¼š${displayDateTime}</div>
            <div class="flex flex-col">
              <span class="text-[10px] text-[#c8aa6e] uppercase tracking-tighter mb-1">è·ç¦»è§£ç¦è¿˜æœ‰</span>
              <span class="text-xl font-bold ${isExpired ? 'text-green-500' : 'text-[#f0e6d2]'}">
                ${isExpired ? 'âœ… å¤„ç½šå·²è§£é™¤' : `${days}å¤© ${h}æ—¶ ${m}åˆ† ${s}ç§’`}
              </span>
            </div>
          </div>
          <div class="flex flex-col space-y-2">
            <button onclick="edit(${i})" class="px-3 py-1 text-[11px] border border-[#c8aa6e] text-[#c8aa6e] hover:bg-[#c8aa6e] hover:text-black transition-all">ä¿®æ”¹</button>
            <button onclick="del(${i})" class="px-3 py-1 text-[11px] border border-red-900 text-red-500 hover:bg-red-900 hover:text-white transition-all">ç§»é™¤</button>
          </div>
        </div>
      </div>`;
    });
}

setInterval(render, 1000);
</script>
</body>
</html>